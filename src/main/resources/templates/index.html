<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>withUs</title>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"
            integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<!--    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">-->
<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poor+Story&display=swap" rel="stylesheet">
    <script th:src="@{/js/sse.js}"></script>
    <style>


        /*전체*/
        .main {
            font-family: 'Poor Story', system-ui;
            padding-right: 20%;
            padding-left: 20%;
            display: flex;
            flex-direction: column;
        }

        /*박스 카드*/
        .card{
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: border-width 0.3s;
        }
        .card:hover {
            border: 2px solid #556976;
        }

        .create {
            margin-left: 15px;
            font-weight: bolder;
        }

        .title2 {
            float: right;
            display: flex;
            align-items: center;
        }
        .page{
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        .title2 img {
            cursor: pointer;
            width: 35px;
            height: 35px;
            margin: 5px;
        }

        .list-group {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .search {
            display: flex;
            align-items: center;
        }

        #searchCategory,
        #searchText {
            border-radius: 10px;
            border: none;
            margin-right: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .search-group {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .list-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .search {
            position: relative;
            width: 35%;
        }

        input {
            width: 100%;
            border: 1px solid #bbb;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 14px;
        }

        .search > img {
            position: absolute;
            width: 17px;
            top: 10px;
            right: 12px;
            margin: 0;
        }


        .white_space {
            width: 100%;
            height: 40px;
        }


        select {
            position: absolute;
            width: 70px;
            top: 3px;
            bottom: 3px;
            right: 101%;
            margin: 0;
        }

        .category {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .btn-group {
            margin-right: 20px;
            margin-left: 20px;
        }

        .btn-group .btn {
            color: black;
        }

        .btn {
            margin-right: 10px;
            border: 0px;
            /*border-radius: 10px;*/
            display: inline-block;
            font: inherit;
            line-height: 1.5em;
            padding: 0.5em 1.7em 0.6em 1.7em;
        }

        .cardGroup {
            text-align: center;
        }

        .cardParent {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding-top: 40px;
        }

        .card {
            width: 600px;
            border: 1px solid black;
            font-weight: bold;
            border-radius: 20px;
            cursor: pointer;
        }

        .img-fluid {
            width: 150px;
            height: 150px;
            border-radius: 1%;
            margin-left: 10px;
            float: left;
        }

        .cardText {
            padding-top: 15px;
            padding-bottom: 10px;
            text-align: center;
            margin-right: 50px;
        }


        .twoImage {
            padding-top: 5%;

        }

        .img-top {
            margin-right: 20px;
            width: 30px;
        }

        .pagination {
            display: flex;
            justify-content: center;
        }

        footer {
            width: 60%;
            position: absolute;
            bottom: 0;
        }

        .btn2 {
            border-radius: 24px;
        }


    </style>
    <script th:inline="javascript">
        let clubId = /*[[${clubId}]]*/ '';
        let category = 'ALL';
        let size = 4;
        let search = '';
        console.log(search)
        let clubImage;
        let clubName;
        let clubContent;
        let memberCount;
        let keyword = '';
        var memberId = /*[[${memberId}]]*/ '';

        $(document).ready(function () {

            console.log("카테고리 : " + category)

            $.ajax({
                type: 'GET',
                url: '/api/club/' + category
                    + '/club?size='+ size
                    + '&sort=createdAt,desc',
                contentType: 'application/json',
                success: function (response) {
                    for (var i = 0; i < response.data.content.length; i++) {
                        var currentItem = response.data.content[i];
                        if (currentItem.imageURL !== null) {
                            clubImage = currentItem.imageURL;
                        } else {
                            clubImage = 'https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/default.png';
                        }
                        clubId = currentItem.clubId;
                        clubName = currentItem.clubTitle;
                        clubContent = currentItem.content;
                        console.log("생성완료");

                        var truncatedContent = clubContent.length > 20 ? clubContent.substring(0, 20) + '...' : clubContent;

                        $.ajax({
                            type: 'GET',
                            url: '/api/club/' + clubId + '/memberCount',
                            contentType: 'application/json',
                            async: false,
                            success: function (countResponse) {
                                memberCount = countResponse.data;
                            },
                            error: function (error) {
                                console.error('Error fetching member count:', error);
                            }
                        });
                        $('#cardGroup').append($('<div class="cardGroup" >\n'
                                + '    <tr>\n'
                                + '      <div class="cardParent">\n'
                                + '        <div id="' + clubId + '" class="card mb-3" onclick="getClub(this.id)">\n'
                                + '          <div>\n'
                                + '            <div>\n'
                                + '              <div class="image">\n'
                                + '                <img src="' + clubImage + '" class="img-fluid rounded-start" alt="...">\n'
                                + '              </div>\n'
                                + '            </div>\n'
                                + '            <div class="cardText">\n'
                                + '              <div>\n'
                                + '                <div class="card-body">\n'
                                + '                  <p class="card-title">' + clubName + '</p>\n'
                                + '                  <p class="card-text">' + truncatedContent + '</p>\n'
                                + '                  <p class="card-text">참가자 ' + memberCount + '명</p>\n'
                                + '                </div>\n'
                                + '              </div>\n'
                                + '            </div>\n'
                                + '          </div>\n'
                                + '        </div>\n'
                                + '      </div>\n'
                                + '    </tr>\n'
                                + '  </div>'
                            )
                        );
                    }
                    let cnt;
                    const cntArray = [];
                    if (response.data.totalElements > 4) {
                        cnt = response.data.totalElements / 4;
                    } else {
                        cnt = 1;
                    }
                    for (var i = 0; i < cnt; i++) {
                        cntArray.push(i + 1);
                    }
                    $(cntArray).each(function (index, res) {
                        // const card = '<li class="page-item"><a class="page-link" href="@{api/notice/{noticeId}(noticeId=${'+noticeId+'})/comment(page=${'+res+'})}">'+res+'</a></li>';
                        const card = '<li class="page-item" style="float: left"><a class="page-link" onclick="sendPage(\''
                            + res + '\')">' + res + '</a></li>';
                        $('#page').append(card);
                    })
                }

            });


            if (memberId !== undefined && memberId !== null && memberId !== '') {
                $('#loginBtn').hide();
                $('#chatting').show();
                $('#myInfo').show();
                $('#create').show();
                $('#logout').show();
                $("#myclub").show();
            } else {
                // memberId가 존재하지 않으면 로그인 버튼을 표시하고 채팅 이미지를 숨깁니다.
                $('#loginBtn').show();
                $('#chatting').hide();
                $('#myInfo').hide();
                $('#create').hide();
                $('#logout').hide();
                $("#myclub").hide();
            }

            // 로그인
            $("#loginBtn").on("click", function (e) {
                window.location.href = '/api/member/loginPage';
            });

            //채팅
            $("#chatting").on("click", function(e) {
              window.location.href = '/api/chat/member/' + memberId + '/chatRoomListPage';
            });
            $("#chatting").on("mouseover", function (e) {
                $("#tooltip2").css({
                    top: e.pageY + 10,
                    left: e.pageX + 10
                });
                $("#tooltip2").show();
            });

            $("#chatting").on("mouseout", function (e) {
                $("#tooltip2").hide();
            });

            $("#chatting").on("click", function (e) {
                getMyClubs();
            });

            // myPage
            $("#myInfo").on("click", function (e) {
                window.location.href = '/api/member/' + memberId + '/profilePage';
            });
            $("#myInfo").on("mouseover", function (e) {
                $("#tooltip1").css({
                    top: e.pageY + 10,
                    left: e.pageX + 10
                });
                $("#tooltip1").show();
            });

            $("#myInfo").on("mouseout", function (e) {
                $("#tooltip1").hide();
            });

            $("#myInfo").on("click", function (e) {
                getMyClubs();
            });

            // 클럽 생성
            $("#create").on("click", function (e) {
                window.location.href = '/api/club/post-club';
            });

            $("#create").on("mouseover", function (e) {
                $("#tooltip").css({
                    top: e.pageY + 10,
                    left: e.pageX + 10
                });
                $("#tooltip").show();
            });

            $("#create").on("mouseout", function (e) {
                $("#tooltip").hide();
            });
            // 내 클럽 조회
            $("#myclub").on("click", function (e) {
                getMyClubs();
            });

            $("#myclub").on("mouseover", function (e) {
                $("#tooltip3").css({
                    top: e.pageY + 10,
                    left: e.pageX + 10
                });

                $("#tooltip3").show();
            });

            $("#myclub").on("mouseout", function (e) {
                $("#tooltip3").hide();
            });

            // 로그아웃
            $("#logout").on("click", function (e) {
                var confirmLogout = window.confirm('로그아웃 하시겠습니까?');

                if (confirmLogout) {

                    $.ajax({
                        type: 'Post',
                        url: '/api/member/logout',
                        contentType: ''
                    })
                        .done(function (res, status, xhr) {
                            window.location.href = '/'
                        })
                        .fail(function (xhr, status, error) {
                            console.error('로그아웃 요청 API 에러', error);
                        })

                }

            });
        });

        // SSE 연결
        if (memberId !== undefined && memberId !== null && memberId !== '') {
          connectSse();
        }

        function getClub(clubId) {
            let url = '/api/club/main-club/' + clubId;
            location.href = url;
        }

        function changeCategory(button) {
            search = document.getElementById('searchCategory').value;
            console.log(search);
            keyword = document.getElementById('searchText').value;
            console.log(keyword);

            if(category === 'ALL'){
                category = button.getAttribute('name');
            } else{
                if(category === button.getAttribute('name')){
                    category = 'ALL';
                } else{
                    category = button.getAttribute('name');
                }
            }

            console.log(category);

            $.ajax({
                type: 'GET',
                url: '/api/club/' + category
                    + '/club?size='+ size
                    + '&keyWord='+ keyword
                    + '&category=' + category
                    + '&sort=createdAt,desc',

                contentType: 'application/json',
                success: function (response) {
                    var buttons = document.getElementsByClassName('btn');
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove('active');
                    }
                    // 클릭된 버튼에 활성 상태 추가
                    if(category !== 'ALL'){
                        button.classList.add('active');
                    }


                    if (response.data.totalElements === 0) {
                        $('#cardGroup').empty();
                        $('#page').empty();
                        $('#cardGroup').append($('<p>검색된 클럽이 없습니다.</p>'))
                    } else {
                        $('#cardGroup').empty();
                        for (var i = 0; i < response.data.content.length; i++) {
                            var currentItem = response.data.content[i];
                            if (currentItem.imageURL !== null) {
                                clubImage = currentItem.imageURL;
                            } else {
                                clubImage = 'https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/default.png';
                            }
                            clubId = currentItem.clubId;
                            clubName = currentItem.clubTitle;
                            clubContent = currentItem.content;
                            console.log("생성완료");
                            var truncatedContent = clubContent.length > 20 ? clubContent.substring(0, 20) + '...' : clubContent;

                            $.ajax({
                                type: 'GET',
                                url: '/api/club/' + clubId + '/memberCount',
                                contentType: 'application/json',
                                async: false,
                                success: function (countResponse) {
                                    memberCount = countResponse.data;
                                },
                                error: function (error) {
                                    console.error('Error fetching member count:', error);
                                }
                            });
                            $('#cardGroup').append($('<div class="cardGroup" >\n'
                                    + '    <tr>\n'
                                    + '      <div class="cardParent">\n'
                                    + '        <div id="' + clubId + '" class="card mb-3" onclick="getClub(this.id)">\n'
                                    + '          <div>\n'
                                    + '            <div>\n'
                                    + '              <div class="image">\n'
                                    + '                <img src="' + clubImage
                                    + '" class="img-fluid rounded-start" alt="...">\n'
                                    + '              </div>\n'
                                    + '            </div>\n'
                                    + '            <div class="cardText">\n'
                                    + '              <div>\n'
                                    + '                <div class="card-body">\n'
                                    + '                  <p class="card-title">' + clubName + '</p>\n'
                                    + '                  <p class="card-text">' + truncatedContent + '</p>\n'
                                    + '                  <p class="card-text">참가자 ' + memberCount + '명</p>\n'
                                    + '                </div>\n'
                                    + '              </div>\n'
                                    + '            </div>\n'
                                    + '          </div>\n'
                                    + '        </div>\n'
                                    + '      </div>\n'
                                    + '    </tr>\n'
                                    + '  </div>'
                                )
                            );
                        }

                        $('#page').empty();
                        let cnt;
                        const cntArray = [];
                        if (response.data.totalElements > 4) {
                            cnt = response.data.totalElements / 4;
                        } else {
                            cnt = 1;
                        }
                        for (var i = 0; i < cnt; i++) {
                            cntArray.push(i + 1);
                        }
                        $(cntArray).each(function (index, res) {
                            // const card = '<li class="page-item"><a class="page-link" href="@{api/notice/{noticeId}(noticeId=${'+noticeId+'})/comment(page=${'+res+'})}">'+res+'</a></li>';
                            const card = '<li class="page-item" style="float: left"><a class="page-link" onclick="sendPage(\''
                                + res + '\')">' + res + '</a></li>';
                            $('#page').append(card);
                        })
                    }
                }
            });
        }

        function handleKeyUp(event) {
            if (event.key === 'Enter') {
                searchKeyword();
            }
        }

        function searchKeyword() {
            $('.category').show();
            // search = $("searchCategory option:selected").val();
            // console.log(search)
            search = document.getElementById('searchCategory').value;
            keyword = document.getElementById('searchText').value;

            $.ajax({
                type: 'GET',
                url: '/api/club/'
                    + category
                    + '/club?size=' + size
                    + '&page=' + 0
                    + '&keyWord=' + keyword
                    + '&searchCategory=' + search
                    + '&sort=createdAt,desc',
                contentType: 'application/json',
                success: function (response) {
                    if (response.data.totalElements === 0) {
                        $('#cardGroup').empty();
                        $('#page').empty();
                        $('#cardGroup').append($('<p>검색된 클럽이 없습니다.</p>'))
                    } else {
                        $('#cardGroup').empty();
                        for (var i = 0; i < response.data.content.length; i++) {
                            var currentItem = response.data.content[i];
                            if (currentItem.imageURL !== null) {
                                clubImage = currentItem.imageURL;
                            } else {
                                clubImage = 'https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/default.png';
                            }
                            clubId = currentItem.clubId;
                            clubName = currentItem.clubTitle;
                            clubContent = currentItem.content;
                            console.log("생성완료");
                            var truncatedContent = clubContent.length > 20 ? clubContent.substring(0, 20) + '...' : clubContent;

                            $.ajax({
                                type: 'GET',
                                url: '/api/club/' + clubId + '/memberCount',
                                contentType: 'application/json',
                                async: false,
                                success: function (countResponse) {
                                    memberCount = countResponse.data;
                                },
                                error: function (error) {
                                    console.error('Error fetching member count:', error);
                                }
                            });
                            $('#cardGroup').append($('<div class="cardGroup" >\n'
                                    + '    <tr>\n'
                                    + '      <div class="cardParent">\n'
                                    + '        <div id="' + clubId + '" class="card mb-3" onclick="getClub(clubId)">\n'
                                    + '          <div>\n'
                                    + '            <div>\n'
                                    + '              <div class="image">\n'
                                    + '                <img src="' + clubImage
                                    + '" class="img-fluid rounded-start" alt="...">\n'
                                    + '              </div>\n'
                                    + '            </div>\n'
                                    + '            <div class="cardText">\n'
                                    + '              <div>\n'
                                    + '                <div class="card-body">\n'
                                    + '                  <p class="card-title">' + clubName + '</p>\n'
                                    + '                  <p class="card-text">' + truncatedContent + '</p>\n'
                                    + '                  <p class="card-text">참가자 ' + memberCount + '명</p>\n'
                                    + '                </div>\n'
                                    + '              </div>\n'
                                    + '            </div>\n'
                                    + '          </div>\n'
                                    + '        </div>\n'
                                    + '      </div>\n'
                                    + '    </tr>\n'
                                    + '  </div>'
                                )
                            );
                        }
                        $('#page').empty();
                        let cnt;
                        const cntArray = [];
                        if (response.data.totalElements > 4) {
                            cnt = response.data.totalElements / 4;
                        } else {
                            cnt = 1;
                        }
                        console.log(cnt);
                        for (var i = 0; i < cnt; i++) {
                            cntArray.push(i + 1);
                        }
                        $(cntArray).each(function (index, res) {
                            // const card = '<li class="page-item"><a class="page-link" href="@{api/notice/{noticeId}(noticeId=${'+noticeId+'})/comment(page=${'+res+'})}">'+res+'</a></li>';
                            const card = '<li class="page-item" style="float: left"><a class="page-link" onclick="sendPage(\''
                                + res + '\')">' + res + '</a></li>';
                            $('#page').append(card);
                        })
                    }
                }
            });
        }

        function sendPage(pageNumber) {
            $('#cardGroup').empty();
            search = document.getElementById('searchCategory').value;
            keyword = document.getElementById('searchText').value;
            $.ajax({
                type: 'GET',
                url: '/api/club/'
                    + category
                    + '/club?size='+ size
                    + '&page=' + (pageNumber-1)
                    + '&keyWord=' + keyword
                    + '&searchCategory=' + search
                    + '&sort=createdAt,desc',
                contentType: 'application/json',
                success: function (response) {
                    for (var i = 0; i < response.data.content.length; i++) {
                        var currentItem = response.data.content[i];
                        if (currentItem.imageURL !== null) {
                            clubImage = currentItem.imageURL;
                        } else {
                            clubImage = 'https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/default.png';
                        }
                        clubId = currentItem.clubId;
                        console.log(clubId);
                        clubName = currentItem.clubTitle;
                        clubContent = currentItem.content;
                        console.log("생성완료");
                        var truncatedContent = clubContent.length > 20 ? clubContent.substring(0, 20) + '...' : clubContent;

                        $.ajax({
                            type: 'GET',
                            url: '/api/club/' + clubId + '/memberCount',
                            contentType: 'application/json',
                            async: false,
                            success: function (countResponse) {
                                memberCount = countResponse.data;
                            },
                            error: function (error) {
                                console.error('Error fetching member count:', error);
                            }
                        });
                        $('#cardGroup').append($('<div class="cardGroup" >\n'
                                + '    <tr>\n'
                                + '      <div class="cardParent">\n'
                                + '        <div id="' + clubId + '" class="card mb-3" onclick="getClub(this.id)">\n'
                                + '          <div>\n'
                                + '            <div>\n'
                                + '              <div class="image">\n'
                                + '                <img src="' + clubImage + '" class="img-fluid rounded-start" alt="...">\n'
                                + '              </div>\n'
                                + '            </div>\n'
                                + '            <div class="cardText">\n'
                                + '              <div>\n'
                                + '                <div class="card-body">\n'
                                + '                  <p class="card-title">' + clubName + '</p>\n'
                                + '                  <p class="card-text">' + truncatedContent + '</p>\n'
                                + '                  <p class="card-text">참가자 ' + memberCount + '명</p>\n'
                                + '                </div>\n'
                                + '              </div>\n'
                                + '            </div>\n'
                                + '          </div>\n'
                                + '        </div>\n'
                                + '      </div>\n'
                                + '    </tr>\n'
                                + '  </div>'
                            )
                        );
                    }
                }
            })
        }

        function getMyClubs() {
            $('.category').hide();
            $.ajax({
                type: 'GET',
                url: '/api/member/club?size='+ size
                    +'&sort=club.createdAt,desc',
                contentType: 'application/json',
                success: function (response) {
                    var buttons = document.getElementsByClassName('btn');
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove('active');
                    }
                    if (response.data.totalElements === 0) {
                        $('#cardGroup').empty();
                        $('#page').empty();
                        $('#cardGroup').append($('<p>검색된 클럽이 없습니다.</p>'))
                    } else {
                        $('#cardGroup').empty();
                        for (var i = 0; i < response.data.content.length; i++) {
                            var currentItem = response.data.content[i];
                            if (currentItem.imageURL !== null) {
                                clubImage = currentItem.imageURL;
                            } else {
                                clubImage = 'https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/default.png';
                            }
                            clubId = currentItem.clubId;
                            clubName = currentItem.clubTitle;
                            clubContent = currentItem.content;
                            console.log("생성완료");
                            var truncatedContent = clubContent.length > 20 ? clubContent.substring(0, 20) + '...' : clubContent;

                            $.ajax({
                                type: 'GET',
                                url: '/api/club/' + clubId + '/memberCount',
                                contentType: 'application/json',
                                async: false,
                                success: function (countResponse) {
                                    memberCount = countResponse.data;
                                },
                                error: function (error) {
                                    console.error('Error fetching member count:', error);
                                }
                            });
                            $('#cardGroup').append($('<div class="cardGroup" >\n'
                                    + '    <tr>\n'
                                    + '      <div class="cardParent">\n'
                                    + '        <div id="' + clubId + '" class="card mb-3" onclick="getClub(this.id)">\n'
                                    + '          <div>\n'
                                    + '            <div>\n'
                                    + '              <div class="image">\n'
                                    + '                <img src="' + clubImage
                                    + '" class="img-fluid rounded-start" alt="...">\n'
                                    + '              </div>\n'
                                    + '            </div>\n'
                                    + '            <div class="cardText">\n'
                                    + '              <div>\n'
                                    + '                <div class="card-body">\n'
                                    + '                  <p class="card-title">' + clubName + '</p>\n'
                                    + '                  <p class="card-text">' + truncatedContent + '</p>\n'
                                    + '                  <p class="card-text">참가자 ' + memberCount + '명</p>\n'
                                    + '                </div>\n'
                                    + '              </div>\n'
                                    + '            </div>\n'
                                    + '          </div>\n'
                                    + '        </div>\n'
                                    + '      </div>\n'
                                    + '    </tr>\n'
                                    + '  </div>'
                                )
                            );
                        }

                        $('#page').empty();
                        let cnt;
                        const cntArray = [];
                        console.log(response.data.totalElements)
                        if (response.data.totalElements > 4) {
                            cnt = Math.floor(response.data.totalElements / 4) + 1;
                        } else {
                            cnt = 1;
                        }
                        for (var i = 0; i < cnt; i++) {
                            cntArray.push(i + 1);
                        }
                        $(cntArray).each(function (index, res) {
                            // const card = '<li class="page-item"><a class="page-link" href="@{api/notice/{noticeId}(noticeId=${'+noticeId+'})/comment(page=${'+res+'})}">'+res+'</a></li>';
                            const card = '<li class="page-item" style="float: left"><a class="page-link" onclick="sendMyClubsPage(\''
                                + res + '\')">' + res + '</a></li>';
                            $('#page').append(card);
                        })
                    }
                }
            });
        }

        function sendMyClubsPage(pageNumber) {
            $('#cardGroup').empty();
            $.ajax({
                type: 'GET',
                url: '/api/member/club?size=' + size
                    +'&page=' + (pageNumber - 1)
                    + '&sort=club.createdAt,desc',
                contentType: 'application/json',
                success: function (response) {
                    for (var i = 0; i < response.data.content.length; i++) {
                        var currentItem = response.data.content[i];
                        if (currentItem.imageURL !== null) {
                            clubImage = currentItem.imageURL;
                        } else {
                            clubImage = 'https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/default.png';
                        }
                        clubId = currentItem.clubId;
                        console.log(clubId);
                        clubName = currentItem.clubTitle;
                        clubContent = currentItem.content;
                        console.log("생성완료");
                        var truncatedContent = clubContent.length > 20 ? clubContent.substring(0, 20) + '...' : clubContent;

                        $.ajax({
                            type: 'GET',
                            url: '/api/club/' + clubId + '/memberCount',
                            contentType: 'application/json',
                            async: false,
                            success: function (countResponse) {
                                memberCount = countResponse.data;
                            },
                            error: function (error) {
                                console.error('Error fetching member count:', error);
                            }
                        });
                        $('#cardGroup').append($('<div class="cardGroup" >\n'
                                + '    <tr>\n'
                                + '      <div class="cardParent">\n'
                                + '        <div id="' + clubId + '" class="card mb-3" onclick="getClub(this.id)">\n'
                                + '          <div>\n'
                                + '            <div>\n'
                                + '              <div class="image">\n'
                                + '                <img src="' + clubImage + '" class="img-fluid rounded-start" alt="...">\n'
                                + '              </div>\n'
                                + '            </div>\n'
                                + '            <div class="cardText">\n'
                                + '              <div>\n'
                                + '                <div class="card-body">\n'
                                + '                  <p class="card-title">' + clubName + '</p>\n'
                                + '                  <p class="card-text">' + truncatedContent + '</p>\n'
                                + '                  <p class="card-text">참가자 ' + memberCount + '명</p>\n'
                                + '                </div>\n'
                                + '              </div>\n'
                                + '            </div>\n'
                                + '          </div>\n'
                                + '        </div>\n'
                                + '      </div>\n'
                                + '    </tr>\n'
                                + '  </div>'
                            )
                        );
                    }
                }
            })
        }
    </script>
</head>
<body style="background-color: #98a9bc; background-size: cover; ">
<div class="main ">
    <div class="title">
        <header>
            <div class="title-group" role="group">
                <div class="title">
                    <h2 class="withUs" th:onclick="|location.href='@{/}'|"
                        style="float: left; cursor: pointer; margin-top: 5px ">withUs</h2>
                </div>
                <div class="title2" style="float: right; display: flex; align-items: center; gap: 20px;">
                    <img src="https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/myclub.png"
                         id="myclub" class="my-info"
                         style="cursor: pointer; width: 35px; height: 35px; margin-top: 5px">
                    <div id="tooltip3"
                         style="display: none; position: absolute; background-color: #fff;
                         padding: 5px; border: 1px solid #ccc; box-shadow: 2px 2px 5px #888888;">
                        내 클럽 목록</div>

                    <img src="https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/message.png"
                         id="chatting" class="chat-icon"
                         style="float: left; cursor: pointer; display: none; width: 35px;
                         height: 35px; margin-right: 5px; margin-top: 5px">
                    <div id="tooltip2" style="display: none; position: absolute; background-color: #fff;
                    padding: 5px; border: 1px solid #ccc; box-shadow: 2px 2px 5px #888888;">
                        채팅</div>

                    <h2 class="login" id="loginBtn" style="float: left; cursor: pointer; margin-top: 5px">login</h2>

                    <!-- 클럽 생성 -->
                    <img src="https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/create.png"
                         id="create" class="create"
                         style="cursor: pointer; width: 35px; height: 35px; margin-top: 5px">
                    <div id="tooltip" style="display: none; position: absolute; background-color: #fff;
                    padding: 5px; border: 1px solid #ccc; box-shadow: 2px 2px 5px #888888;">
                        클럽 생성</div>

                    <img src="https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/myInfo.png"
                         id="myInfo" class="my-info"
                         style="cursor: pointer; width: 35px; height: 35px; margin-top: 5px">
                    <div id="tooltip1" style="display: none; position: absolute; background-color: #fff;
                    padding: 5px; border: 1px solid #ccc; box-shadow: 2px 2px 5px #888888;">
                        MyPage</div>

                    <img src="https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/arrow_10940959.png"
                         id="logout" class="my-info"
                         style="float: right; cursor: pointer; width: 35px; height: 35px; margin-top: 5px">
                </div>
            </div>
        </header>
    </div>

    <div class="search-group">
        <div class="list-group">
            <div class="search">
                <select id="searchCategory">
                    <option value="title" selected>제목</option>
                    <option value="content">내용</option>
                </select>
                <input type="text" id="searchText" placeholder="검색어 입력" onkeyup="handleKeyUp(event)">
                <img src="https://sparta-withus.s3.ap-northeast-2.amazonaws.com/image/icon/icon-search.png" onclick="searchKeyword()">
            </div>
        </div>
    </div>

    <div class="white_space">
    </div>
    <div class="category">
        <div class="btn-group" role="group" aria-label="Basic outlined example">
            <button type="button" class="btn btn-outline-primary" name="SPORTS" onclick="changeCategory(this)">운동
            </button>
            <button type="button" class="btn btn-outline-primary" name="TODAY" onclick="changeCategory(this)">일상
            </button>
            <button type="button" class="btn btn-outline-primary" name="GAME" onclick="changeCategory(this)">게임</button>
            <button type="button" class="btn btn-outline-primary" name="FOOD" onclick="changeCategory(this)">음식</button>
            <button type="button" class="btn btn-outline-primary" name="STUDY" onclick="changeCategory(this)">스터디
            </button>
            <button type="button" class="btn btn-outline-primary" name="ETC" onclick="changeCategory(this)">기타</button>
        </div>
    </div>


    <div id="cardGroup">
    </div>
    <nav aria-label="Page navigation example" class="pageNav">
        <ul class="pagination">
            <div class="page" id="page">
            </div>
        </ul>
    </nav>
</div>
</body>
</html>